## Модуль интеграции с CMS Wordpress Woocommerce

Данный модуль обеспечивает взаимодействие между интернет-магазином на базе CMS WordPress с модулем электронной комерции WooCommerce и сервисом платежей [ХуткiГрош](hutkigrosh.by)

### Требования ###
1. PHP 5.6 и выше 
1. Библиотека Curl 

## Инструкция по установке:
### Автоматическая установка (через Wordpress Plugin Directory) 
1. Перейти на страницу _Плагины > Добавить новый_
1. Введите в поиске _Hutkigrosh_
1. Установите плагин 
1. Активируйте плагин
1. Перейдите к настройке

### Ручная установка
1. Создайте резервную копию вашего магазина и базы данных
1. Загрузите архив модуля [woocommerce-gateway-hutkigrosh.zip](https://github.com/esasby/hutkigrosh-wordpress4-woocommerce3-module/blob/master/woocommerce-gateway-hutkigrosh.zip) с помощью _Модули_ -> _Установка расширений_
1. Через панель администратора Wordpress зайдите в меню __Плагины > Добавить новый__
1. Нажмите __Загрузить плагин__
1. Выберите загруженый в п2. архив модуля woocommerce-gateway-hutkigrosh.zip и установите
1. Активируйте плагин в меню Плагины -> Установленные
1. Перейдите к настройке

## Инструкция по настройке
1. Перейдите к настройке плагина через меню __WooCommerce -> Настройки -> Платежи__
1. Укажите обязательные параметры
    * Уникальный идентификатор услуги ЕРИП – ID ЕРИП услуги
    * Код услуги – код услуги в деревер ЕРИП. Используется при генерации QR-кода
    * Логин интернет-магазина – логин в системе ХуткiГрош.
    * Пароль интернет-магазина – пароль в системе ХуткiГрош.
    * Sandbox - перевод модуля в тестовый режим работы. В этом режиме счета выставляются в тестовую систему wwww.trial.hgrosh.by
    * Sms оповещение - включить информирование клиента по смс при успешном выставлении счета (выполняется шлюзом Хуткiгрош)
    * Email оповещение - включить информирование клиента по email при успешном выставлении счета (выполняется шлюзом Хуткiгрош)
    * Кнопка QR-code - если включена, то на итоговом экране клиенту будет доступна оплата счета по QR-коду
    * Кнопка Alfaclick - если включена, то на итоговом экране клиенту отобразится кнопка для выставления счета в Alfaclick
    * Кнопка Webpay - если включена, то на итоговом экране клиенту отобразится кнопка для оплаты счета картой (переход на Webpay)
    * Статус при выставлении счета  - какой статус выставить заказу при успешном выставлении счета в ЕРИП (идентификатор существующего статуса из Магазин > Настройки > Статусы)
    * Статус при успешной оплате счета - какой статус выставить заказу при успешной оплате выставленного счета (идентификатор существующего статуса)
    * Статус при отмене оплаты счета - какой статус выставить заказу при отмене оплаты счета (идентификатор существующего статуса)
    * Статус при ошибке оплаты счета - какой статус выставить заказу при ошибке выставленния счета (идентификатор существующего статуса)
    * Путь в дереве ЕРИП - путь для оплаты счета в дереве ЕРИП, который будет показан клиенту после оформления заказа (например, Платежи > Магазин > Заказы)
    * Срок действия счета - как долго счет, будет доступен в ЕРИП для оплаты
1. Сохраните изменения.

### Внимание!
Для автоматического обновления статуса заказа (после оплаты клиентом выставленного в ЕРИП счета) необходимо сообщить в службу технической поддержки сервиса «Хуткi Грош» адрес обработчика:
```
http://mydomen.my/wordpress/?wc-api=gateway_hutkigrosh
```

### Тестовые данные
Для настрой оплаты в тестовом режиме:
 * воспользуйтесь данными для подключения к тестовой системе, полученными при регистрации в ХуткiГрош
 * включите в настройках модуля режим "Песочницы" 
 * для эмуляции оплаты клиентом выставленного счета воспльзуйтесь личным кабинетом [тестовой системы](https://trial.hgrosh.by) (меню _Тест оплаты ЕРИП_)

_Разработано и протестировано с Wordpress v.4.9.8 и WooCommerce v.3.5.0_


### Файлы логов
Логи модуля доступны по пути:

`<wordpress home>/wp-content/plugins/woo-hutkigrosh-gateway/vendor/esas/hutkigrosh-api-php/logs/hutkigrosh.log`